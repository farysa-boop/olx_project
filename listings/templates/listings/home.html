{% extends "base.html" %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <h1 style="font-size: 32px; color: #111827; margin-bottom: 30px;">–û–±—ä—è–≤–ª–µ–Ω–∏—è</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div style="background: white; padding: 25px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 30px;">
        <form method="get" style="display: flex; gap: 15px; flex-wrap: wrap;">
            <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
            <div style="flex: 2; min-width: 250px;">
                <input
                    type="text"
                    name="q"
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..."
                    value="{{ q }}"
                    style="width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 15px; outline: none; transition: border 0.2s;"
                    onfocus="this.style.borderColor='#2563eb'"
                    onblur="this.style.borderColor='#e5e7eb'"
                >
            </div>

            <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div style="flex: 1; min-width: 200px;">
                <select 
                    name="category"
                    style="width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 15px; background: white; cursor: pointer; outline: none;"
                >
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for c in categories %}
                        <option value="{{ c.slug }}" {% if selected_category == c.slug %}selected{% endif %}>
                            {{ c.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
            <div>
                <button type="submit" style="padding: 12px 30px; background: #2563eb; color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: background 0.2s; display: flex; align-items: center; gap: 8px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    –ù–∞–π—Ç–∏
                </button>
            </div>
        </form>

        <!-- –°—á–µ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div style="margin-top: 15px; font-size: 14px; color: #6b7280;">
            –ù–∞–π–¥–µ–Ω–æ: <strong>{{ products.count }}</strong> –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
    {% if products %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px;">
            {% for item in products %}
                <div style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s; position: relative;"
                     onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(0,0,0,0.1)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                    
                    <!-- –ó–∞–≥–ª—É—à–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div style="height: 180px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1">
                            <rect x="2" y="2" width="20" height="20" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5" fill="white"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>

                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                    <div style="padding: 20px;">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ü–µ–Ω–∞ -->
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <a href="{% url 'listing_detail' item.pk %}" style="text-decoration: none; color: inherit; flex: 1;">
                                <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0 10px 0 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                    {{ item.title }}
                                </h3>
                            </a>
                            <span style="font-size: 20px; font-weight: bold; color: #059669; white-space: nowrap;">
                                {{ item.price }} {{ item.currency }}
                            </span>
                        </div>

                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                        <div style="margin-bottom: 15px;">
                            <span style="background: #f3f4f6; color: #4b5563; padding: 4px 12px; border-radius: 20px; font-size: 13px;">
                                {{ item.category.name }}
                            </span>
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <p style="color: #6b7280; font-size: 14px; line-height: 1.5; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            {{ item.description|truncatechars:100 }}
                        </p>

                        <!-- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º –∏ –¥–∞—Ç–æ–π -->
                        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f3f4f6; padding-top: 15px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 30px; height: 30px; background: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">
                                    {{ item.author.username|first|upper }}
                                </div>
                                <span style="font-size: 14px; color: #374151;">{{ item.author.username }}</span>
                            </div>
                            <span style="font-size: 12px; color: #9ca3af;">
                                {{ item.created_at|date:"d.m.Y" }}
                            </span>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
                    {% if user.is_authenticated %}
                        <form method="post" action="{% url 'toggle_favorite' item.pk %}" style="position: absolute; top: 10px; right: 10px;">
                            {% csrf_token %}
                            <button type="submit" style="background: white; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 20px; transition: transform 0.2s;"
                                    onmouseover="this.style.transform='scale(1.1)'"
                                    onmouseout="this.style.transform='scale(1)'">
                                {% if user in item.favorites.all %}
                                    ‚ù§Ô∏è
                                {% else %}
                                    ü§ç
                                {% endif %}
                            </button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 16px;">
            <div style="font-size: 48px; margin-bottom: 20px;">üîç</div>
            <h3 style="font-size: 20px; color: #111827; margin-bottom: 10px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p style="color: #6b7280; margin-bottom: 25px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
            <a href="{% url 'listing' %}" style="display: inline-block; padding: 12px 30px; background: #2563eb; color: white; text-decoration: none; border-radius: 10px; font-weight: 500;">
                –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </a>
        </div>
    {% endif %}
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
<style>
    button:hover, a:hover {
        opacity: 0.9;
    }
    input:focus, select:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
</style>
{% endblock %}